<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plastic Leakage Assessment Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .header h1 { color: #2c3e50; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #7f8c8d; font-size: 1.1em; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .input-panel, .results-panel { background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); max-height: 90vh; overflow-y: auto; }
        .section { margin-bottom: 20px; border: 2px solid #e8f4fd; border-radius: 10px; padding: 15px; transition: all 0.3s; }
        .section:hover { border-color: #3498db; }
        .section-header { display: flex; justify-content: space-between; cursor: pointer; padding: 10px; background: linear-gradient(90deg, #3498db, #2980b9); color: white; border-radius: 8px; margin-bottom: 15px; }
        .section-header h3 { font-size: 1.1em; }
        .toggle-btn { background: none; border: none; color: white; font-size: 1.2em; cursor: pointer; }
        .section-content.collapsed { display: none; }
        .subsection { background: #f8f9fa; padding: 12px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #3498db; }
        .subsection h4 { color: #2c3e50; margin-bottom: 10px; font-size: 1em; }
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; font-size: 0.9em; }
        .input-help { font-size: 0.8em; color: #7f8c8d; margin-bottom: 5px; }
        .input-group input, .input-group select { width: 100%; padding: 8px; border: 2px solid #e8f4fd; border-radius: 6px; font-size: 0.9em; transition: border-color 0.3s; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #3498db; }
        .calculate-btn { background: linear-gradient(90deg, #27ae60, #2ecc71); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; width: 100%; margin-top: 20px; transition: transform 0.2s; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3); }
        .results-summary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; }
        .total-leakage { font-size: 2.2em; font-weight: bold; text-align: center; margin-bottom: 10px; }
        .unit { font-size: 1.1em; text-align: center; }
        .chart-container { margin: 20px 0; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #barChartContainer { height: 500px; }
        #pieChartContainer { height: 400px; }
        .results-table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .results-table th, .results-table td { padding: 10px 8px; text-align: left; border-bottom: 1px solid #ecf0f1; font-size: 0.9em; }
        .results-table th { background: linear-gradient(90deg, #34495e, #2c3e50); color: white; font-weight: bold; }
        .results-table tr:hover { background: #f8f9fa; }
        .results-table .level-1 { font-weight: bold; background: #e8f4fd; }
        .results-table .level-2 { padding-left: 30px; background: #f8f9fa; }
        .results-table .level-3 { padding-left: 50px; font-size: 0.85em; }
        .results-table .total-row { font-weight: bold; background: #3498db; color: white; font-size: 1.1em; }
        .default-values { background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 8px 0; font-size: 0.85em; }
        .default-values h5 { color: #2c3e50; margin-bottom: 5px; font-size: 0.9em; }
        .default-values p { color: #7f8c8d; margin: 3px 0; }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } .header h1 { font-size: 2em; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Plastic Leakage Calculator</h1>
            <p>Based on Guiding Document v3</p>
        </div>

        <div class="main-content">
            <div class="input-panel">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Data Input Panel</h2>
                
                <div class="section">
                    <div class="section-header" onclick="toggle('basic')">
                        <h3>Basic Information</h3>
                        <button class="toggle-btn" id="basic-btn">âˆ’</button>
                    </div>
                    <div class="section-content" id="basic">
                        <div class="input-group">
                            <label>Select Country/Region</label>
                            <div class="input-help">Population will auto-fill based on World Bank 2022 data</div>
                            <select id="country" onchange="loadCountry()">
                                <option value="">-- Select Country --</option>
                                <option value="afghanistan">Afghanistan</option>
                                <option value="albania">Albania</option>
                                <option value="algeria">Algeria</option>
                                <option value="angola">Angola</option>
                                <option value="argentina">Argentina</option>
                                <option value="australia">Australia</option>
                                <option value="austria">Austria</option>
                                <option value="bangladesh">Bangladesh</option>
                                <option value="belgium">Belgium</option>
                                <option value="brazil">Brazil</option>
                                <option value="bulgaria">Bulgaria</option>
                                <option value="cambodia">Cambodia</option>
                                <option value="cameroon">Cameroon</option>
                                <option value="canada">Canada</option>
                                <option value="chile">Chile</option>
                                <option value="china">China</option>
                                <option value="colombia">Colombia</option>
                                <option value="croatia">Croatia</option>
                                <option value="cuba">Cuba</option>
                                <option value="czechia">Czech Republic</option>
                                <option value="denmark">Denmark</option>
                                <option value="drc">DR Congo</option>
                                <option value="ecuador">Ecuador</option>
                                <option value="egypt">Egypt</option>
                                <option value="ethiopia">Ethiopia</option>
                                <option value="finland">Finland</option>
                                <option value="france">France</option>
                                <option value="germany">Germany</option>
                                <option value="ghana">Ghana</option>
                                <option value="greece">Greece</option>
                                <option value="guatemala">Guatemala</option>
                                <option value="hungary">Hungary</option>
                                <option value="india">India</option>
                                <option value="indonesia">Indonesia</option>
                                <option value="iran">Iran</option>
                                <option value="iraq">Iraq</option>
                                <option value="ireland">Ireland</option>
                                <option value="israel">Israel</option>
                                <option value="italy">Italy</option>
                                <option value="japan">Japan</option>
                                <option value="jordan">Jordan</option>
                                <option value="kazakhstan">Kazakhstan</option>
                                <option value="kenya">Kenya</option>
                                <option value="southkorea">Korea, South</option>
                                <option value="malaysia">Malaysia</option>
                                <option value="mexico">Mexico</option>
                                <option value="morocco">Morocco</option>
                                <option value="mozambique">Mozambique</option>
                                <option value="myanmar">Myanmar</option>
                                <option value="nepal">Nepal</option>
                                <option value="netherlands">Netherlands</option>
                                <option value="newzealand">New Zealand</option>
                                <option value="nigeria">Nigeria</option>
                                <option value="norway">Norway</option>
                                <option value="pakistan">Pakistan</option>
                                <option value="peru">Peru</option>
                                <option value="philippines">Philippines</option>
                                <option value="poland">Poland</option>
                                <option value="portugal">Portugal</option>
                                <option value="romania">Romania</option>
                                <option value="russia">Russian Federation</option>
                                <option value="saudiarabia">Saudi Arabia</option>
                                <option value="senegal">Senegal</option>
                                <option value="serbia">Serbia</option>
                                <option value="singapore">Singapore</option>
                                <option value="slovakia">Slovakia</option>
                                <option value="southafrica">South Africa</option>
                                <option value="spain">Spain</option>
                                <option value="srilanka">Sri Lanka</option>
                                <option value="sudan">Sudan</option>
                                <option value="sweden">Sweden</option>
                                <option value="switzerland">Switzerland</option>
                                <option value="syria">Syria</option>
                                <option value="taiwan">Taiwan</option>
                                <option value="tanzania">Tanzania</option>
                                <option value="thailand">Thailand</option>
                                <option value="turkey">TÃ¼rkiye</option>
                                <option value="uganda">Uganda</option>
                                <option value="uae">UAE</option>
                                <option value="uk">United Kingdom</option>
                                <option value="ukraine">Ukraine</option>
                                <option value="usa">United States</option>
                                <option value="uzbekistan">Uzbekistan</option>
                                <option value="venezuela">Venezuela</option>
                                <option value="vietnam">Vietnam</option>
                                <option value="yemen">Yemen</option>
                                <option value="zambia">Zambia</option>
                                <option value="zimbabwe">Zimbabwe</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Population</label>
                            <input type="number" id="pop" placeholder="e.g., 84000000" min="0">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('prod')">
                        <h3>A1.1 Plastic Production & Manufacturing</h3>
                        <button class="toggle-btn" id="prod-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="prod">
                        <div class="default-values">
                            <h5>Default Leakage: 0.01-0.04% per stage</h5>
                        </div>
                        <div class="input-group">
                            <label>Plastic Produced/Handled (kg/yr)</label>
                            <input type="number" id="prodAmt" placeholder="e.g., 100000000">
                        </div>
                        <div class="input-group">
                            <label>Production Leakage (%)</label>
                            <input type="number" id="prodLeak" value="0.025" step="0.001">
                        </div>
                        <div class="input-group">
                            <label>Handling Leakage (%)</label>
                            <input type="number" id="handleLeak" value="0.025" step="0.001">
                        </div>
                        <div class="input-group">
                            <label>Processing Leakage (%)</label>
                            <input type="number" id="procLeak" value="0.025" step="0.001">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('direct')">
                        <h3>A1.2 Direct Sources (Agriculture, Fisheries, Aquaculture)</h3>
                        <button class="toggle-btn" id="direct-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="direct">
                        
                        <div class="subsection">
                            <h4>A1.2.1 Agriculture</h4>
                            
                            <h5 style="margin: 10px 0 5px 0; color: #3498db;">Plastic Mulching</h5>
                            <div class="input-group">
                                <label>Area (ha)</label>
                                <input type="number" id="mulchArea" placeholder="e.g., 50000">
                            </div>
                            <div class="input-group">
                                <label>Application Rate (kg/ha)</label>
                                <input type="number" id="mulchRate" value="63">
                            </div>
                            <div class="input-group">
                                <label>Retrieval Rate (%)</label>
                                <input type="number" id="mulchRetr" value="32">
                            </div>

                            <h5 style="margin: 10px 0 5px 0; color: #3498db;">Greenhouses</h5>
                            <div class="input-group">
                                <label>Area (ha)</label>
                                <input type="number" id="ghArea" placeholder="e.g., 10000">
                            </div>
                            <div class="input-group">
                                <label>Usage Rate (kg/ha)</label>
                                <input type="number" id="ghRate" value="3500">
                            </div>
                            <div class="input-group">
                                <label>Collection Rate (%)</label>
                                <input type="number" id="ghColl" value="40">
                            </div>

                            <h5 style="margin: 10px 0 5px 0; color: #3498db;">Irrigation</h5>
                            <div class="input-group">
                                <label>Area (ha)</label>
                                <input type="number" id="irrArea" placeholder="e.g., 25000">
                            </div>
                            <div class="input-group">
                                <label>Application Rate (kg/ha)</label>
                                <input type="number" id="irrRate" value="400">
                            </div>
                            <div class="input-group">
                                <label>Retrieval Rate (%)</label>
                                <input type="number" id="irrRetr" value="42">
                            </div>

                            <h5 style="margin: 10px 0 5px 0; color: #3498db;">Silage</h5>
                            <div class="input-group">
                                <label>Area (ha)</label>
                                <input type="number" id="silArea" placeholder="e.g., 15000">
                            </div>
                            <div class="input-group">
                                <label>Application Rate (kg/ha)</label>
                                <input type="number" id="silRate" value="23.5">
                            </div>
                            <div class="input-group">
                                <label>Degradation Rate (%)</label>
                                <input type="number" id="silDeg" value="1">
                            </div>
                            <div class="input-group">
                                <label>Retrieval Rate (%)</label>
                                <input type="number" id="silRetr" value="78">
                            </div>

                            <h5 style="margin: 10px 0 5px 0; color: #3498db;">Coated Seeds/Fertilizers</h5>
                            <div class="input-group">
                                <label>Area (ha)</label>
                                <input type="number" id="coatArea" placeholder="e.g., 100000">
                            </div>
                            <div class="input-group">
                                <label>Seeds Rate (kg/ha)</label>
                                <input type="number" id="seedRate" value="50">
                            </div>
                            <div class="input-group">
                                <label>Seeds Plastic (%)</label>
                                <input type="number" id="seedPlast" value="2">
                            </div>
                            <div class="input-group">
                                <label>Fertilizer Rate (kg/ha)</label>
                                <input type="number" id="fertRate" value="40">
                            </div>
                            <div class="input-group">
                                <label>Fertilizer Plastic (%)</label>
                                <input type="number" id="fertPlast" value="2">
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>A1.2.2 Fisheries</h4>
                            <div class="input-group">
                                <label>Annual Catch (tonnes)</label>
                                <input type="number" id="fishCatch" placeholder="e.g., 500000">
                            </div>
                            <div class="input-group">
                                <label>Lost Gear (kg/tonne)</label>
                                <input type="number" id="gearLoss" value="0.75" step="0.01">
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>A1.2.3 Aquaculture</h4>
                            <div class="input-group">
                                <label>Production (tonnes)</label>
                                <input type="number" id="aquaProd" placeholder="e.g., 200000">
                            </div>
                            <div class="input-group">
                                <label>Leakage Factor (kg/tonne)</label>
                                <input type="number" id="aquaLeak" value="0.15" step="0.01">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('diffuse')">
                        <h3>A1.3 Diffuse Pollution Sources</h3>
                        <button class="toggle-btn" id="diffuse-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="diffuse">
                        <div class="subsection">
                            <h4>Artificial Turf</h4>
                            <div class="input-group">
                                <label>Area (mÂ²)</label>
                                <input type="number" id="turfArea" placeholder="e.g., 1000000">
                            </div>
                            <div class="input-group">
                                <label>Fiber Density (kg/mÂ²)</label>
                                <input type="number" id="turfDens" value="1.5" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>Leakage (%/yr)</label>
                                <input type="number" id="turfLeak" value="5" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>Infill Loss (kg/mÂ²/yr)</label>
                                <input type="number" id="infillLoss" value="0.005" step="0.001">
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>Rubber Surfaces</h4>
                            <div class="input-group">
                                <label>Area (mÂ²)</label>
                                <input type="number" id="rubArea" placeholder="e.g., 100000">
                            </div>
                            <div class="input-group">
                                <label>Density (kg/mÂ²)</label>
                                <input type="number" id="rubDens" value="12">
                            </div>
                            <div class="input-group">
                                <label>Leakage (g/mÂ²/yr)</label>
                                <input type="number" id="rubLeak" value="13.4" step="0.1">
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>Paint</h4>
                            <div class="input-group">
                                <label>Supply (kg/yr)</label>
                                <input type="number" id="paintSupp" placeholder="e.g., 10000000">
                            </div>
                            <div class="input-group">
                                <label>Sector</label>
                                <select id="paintSect">
                                    <option value="8">Architectural (8%)</option>
                                    <option value="6">Automotive (6%)</option>
                                    <option value="39">Maritime (39%)</option>
                                    <option value="14">Road marking (14%)</option>
                                    <option value="9">Industrial wood (9%)</option>
                                    <option value="2">General industry (2%)</option>
                                </select>
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>Shoe Soles</h4>
                            <div class="input-group">
                                <label>Leakage (kg/person/yr)</label>
                                <input type="number" id="shoeLeak" value="0.0753" step="0.0001">
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>Tyre Abrasion</h4>
                            <div class="input-group">
                                <label>Distance (km/yr)</label>
                                <input type="number" id="tyreDist" placeholder="e.g., 500000000">
                            </div>
                            <div class="input-group">
                                <label>Loss Rate (mg/km)</label>
                                <input type="number" id="tyreLoss" value="150">
                            </div>
                            <div class="input-group">
                                <label>Plastic Fraction (%)</label>
                                <input type="number" id="tyrePlast" value="35">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('waste')">
                        <h3>A1.4 Wastewater</h3>
                        <button class="toggle-btn" id="waste-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="waste">
                        <div class="input-group">
                            <label>Treated (mÂ³/yr)</label>
                            <input type="number" id="wwTreat" placeholder="e.g., 1000000000">
                        </div>
                        <div class="input-group">
                            <label>Influent Conc (mg/L)</label>
                            <input type="number" id="wwConc" value="5" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Removal Eff (%)</label>
                            <input type="number" id="wwRem" value="90">
                        </div>
                        <div class="input-group">
                            <label>Overflow (mÂ³/yr)</label>
                            <input type="number" id="wwOver" placeholder="e.g., 50000000">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('solid')">
                        <h3>A1.5 Solid Waste Management</h3>
                        <button class="toggle-btn" id="solid-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="solid">
                        <div class="input-group">
                            <label>Plastic Waste (kg/yr)</label>
                            <input type="number" id="swGen" placeholder="e.g., 50000000">
                        </div>
                        <div class="input-group">
                            <label>Collection Loss (%)</label>
                            <input type="number" id="swColl" value="22.5">
                        </div>
                        <div class="input-group">
                            <label>Transport Loss (%)</label>
                            <input type="number" id="swTrans" value="4">
                        </div>
                        <div class="input-group">
                            <label>Disposal Loss (%)</label>
                            <input type="number" id="swDisp" value="15">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('uncoll')">
                        <h3>A1.6 Uncollected Waste</h3>
                        <button class="toggle-btn" id="uncoll-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="uncoll">
                        <div class="default-values">
                            <h5>Reference Values (kg/person/yr):</h5>
                            <p>High Income: Litter 0.065, Burn 0.01</p>
                            <p>Middle Income: Litter 0.2-0.3, Burn 3-7</p>
                            <p>Low Income: Litter 0.5, Burn 3-5</p>
                        </div>
                        <div class="input-group">
                            <label>Littering (kg/person/yr)</label>
                            <input type="number" id="litter" value="0.2" step="0.001">
                        </div>
                        <div class="input-group">
                            <label>Open Burning (kg/person/yr)</label>
                            <input type="number" id="burn" value="3" step="0.1">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggle('recov')">
                        <h3>A1.7 Plastic Recovery</h3>
                        <button class="toggle-btn" id="recov-btn">+</button>
                    </div>
                    <div class="section-content collapsed" id="recov">
                        <div class="input-group">
                            <label>Collected for Recycling (kg/yr)</label>
                            <input type="number" id="recColl" placeholder="e.g., 5000000">
                        </div>
                        <div class="input-group">
                            <label>Mismanagement Rate</label>
                            <select id="recMis">
                                <option value="0.65">High Income (0.65%)</option>
                                <option value="3.08">Upper Middle (3.08%)</option>
                                <option value="14.00">Lower Middle (14.00%)</option>
                                <option value="45.59">Low Income (45.59%)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calc()">Calculate Plastic Leakage</button>
            </div>

            <div class="results-panel">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Results</h2>
                
                <div class="results-summary" id="summary" style="display:none;">
                    <div class="total-leakage" id="total">0</div>
                    <div class="unit">kg/year Total Plastic Leakage</div>
                </div>

                <div class="chart-container" id="pieDiv" style="display:none;">
                    <canvas id="pie"></canvas>
                </div>

                <div class="chart-container" id="barDiv" style="display:none;">
                    <canvas id="bar"></canvas>
                </div>

                <table class="results-table" id="table" style="display:none;">
                    <thead>
                        <tr>
                            <th>Leakage Source</th>
                            <th>Amount (kg/yr)</th>
                            <th>Percentage</th>
                            <th>Per Capita</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let pieChart, barChart;
        
        const countries = {
            afghanistan: 41129000, albania: 2776000, algeria: 44903000, angola: 35589000,
            argentina: 46235000, australia: 25979000, austria: 9043000, bangladesh: 171186000,
            belgium: 11669000, brazil: 215313000, bulgaria: 6465000, cambodia: 16768000,
            cameroon: 27915000, canada: 38930000, chile: 19604000, china: 1412175000,
            colombia: 51874000, croatia: 3854000, cuba: 11212000, czechia: 10526000,
            denmark: 5903000, drc: 99010000, ecuador: 18001000, egypt: 110990000,
            ethiopia: 123380000, finland: 5557000, france: 67936000, germany: 84080000,
            ghana: 33476000, greece: 10567000, guatemala: 17358000, hungary: 9684000,
            india: 1417173000, indonesia: 275501000, iran: 88551000, iraq: 44496000,
            ireland: 5087000, israel: 9551000, italy: 58857000, japan: 125125000,
            jordan: 11286000, kazakhstan: 19622000, kenya: 54027000, southkorea: 51628000,
            malaysia: 33938000, mexico: 127504000, morocco: 37458000, mozambique: 32970000,
            myanmar: 54179000, nepal: 30548000, netherlands: 17703000, newzealand: 5124000,
            nigeria: 218541000, norway: 5457000, pakistan: 235825000, peru: 34050000,
            philippines: 115559000, poland: 37562000, portugal: 10379000, romania: 18957000,
            russia: 143556000, saudiarabia: 36409000, senegal: 17316000, serbia: 6760000,
            singapore: 5637000, slovakia: 5432000, southafrica: 59894000, spain: 47615000,
            srilanka: 22181000, sudan: 46874000, sweden: 10487000, switzerland: 8770000,
            syria: 22125000, taiwan: 23894000, tanzania: 65498000, thailand: 71697000,
            turkey: 85341000, uganda: 47250000, uae: 9441000, uk: 66971000,
            ukraine: 38000000, usa: 333288000, uzbekistan: 35648000, venezuela: 28302000,
            vietnam: 98187000, yemen: 33697000, zambia: 20018000, zimbabwe: 16321000
        };

        function loadCountry() {
            const c = document.getElementById('country').value;
            if (c && countries[c]) {
                document.getElementById('pop').value = countries[c];
            }
        }

        function toggle(id) {
            const content = document.getElementById(id);
            const btn = document.getElementById(id + '-btn');
            content.classList.toggle('collapsed');
            btn.textContent = content.classList.contains('collapsed') ? '+' : 'âˆ’';
        }

        function v(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function calc() {
            const pop = v('pop');
            
            // A1.1 Production
            const prod = v('prodAmt') * (v('prodLeak') + v('handleLeak') + v('procLeak')) / 100;
            
            // A1.2 Direct Sources - Agriculture
            const mulch = v('mulchArea') * v('mulchRate') * (100 - v('mulchRetr')) / 100;
            const gh = v('ghArea') * v('ghRate') * (100 - v('ghColl')) / 100;
            const irr = v('irrArea') * v('irrRate') * (100 - v('irrRetr')) / 100;
            const sil = v('silArea') * v('silRate') * v('silDeg') / 100 * (100 - v('silRetr')) / 100;
            const seed = v('coatArea') * v('seedRate') * v('seedPlast') / 100;
            const fert = v('coatArea') * v('fertRate') * v('fertPlast') / 100;
            const agri = mulch + gh + irr + sil + seed + fert;
            
            // A1.2 Direct Sources - Fisheries
            const fish = v('fishCatch') * v('gearLoss');
            
            // A1.2 Direct Sources - Aquaculture
            const aqua = v('aquaProd') * v('aquaLeak');
            
            const direct = agri + fish + aqua;
            
            // A1.3 Diffuse
            const turf = (v('turfArea') * v('turfDens') * v('turfLeak') / 100) + (v('turfArea') * v('infillLoss'));
            const rub = v('rubArea') * v('rubDens') * v('rubLeak') / 1000;
            const paint = v('paintSupp') * v('paintSect') / 100;
            const shoe = pop * v('shoeLeak');
            const tyre = v('tyreDist') * v('tyreLoss') / 1000000 * v('tyrePlast') / 100;
            const diffuse = turf + rub + paint + shoe + tyre;
            
            // A1.4 Wastewater
            const wwTreat = v('wwTreat') * v('wwConc') / 1000 * (100 - v('wwRem')) / 100;
            const wwOver = v('wwOver') * v('wwConc') / 1000;
            const ww = wwTreat + wwOver;
            
            // A1.5 Solid Waste
            const swC = v('swGen') * v('swColl') / 100;
            const swT = (v('swGen') - swC) * v('swTrans') / 100;
            const swD = (v('swGen') - swC - swT) * v('swDisp') / 100;
            const solid = swC + swT + swD;
            
            // A1.6 Uncollected
            const lit = pop * v('litter');
            const brn = pop * v('burn');
            const uncoll = lit + brn;
            
            // A1.7 Recovery
            const rec = v('recColl') * v('recMis') / 100;
            
            const total = prod + direct + diffuse + ww + solid + uncoll + rec;
            
            document.getElementById('total').textContent = total.toLocaleString('en-US', {maximumFractionDigits: 0});
            document.getElementById('summary').style.display = 'block';
            
            const data = [
                {name: 'A1.1 Production', val: prod, children: []},
                {name: 'A1.2 Direct Sources', val: direct, children: [
                    {name: 'Agriculture', val: agri, children: [
                        {name: 'Mulching', val: mulch},
                        {name: 'Greenhouses', val: gh},
                        {name: 'Irrigation', val: irr},
                        {name: 'Silage', val: sil},
                        {name: 'Coated Materials', val: seed + fert}
                    ]},
                    {name: 'Fisheries', val: fish, children: []},
                    {name: 'Aquaculture', val: aqua, children: []}
                ]},
                {name: 'A1.3 Diffuse Sources', val: diffuse, children: [
                    {name: 'Artificial Turf', val: turf},
                    {name: 'Rubber Surfaces', val: rub},
                    {name: 'Paint', val: paint},
                    {name: 'Shoe Soles', val: shoe},
                    {name: 'Tyre Abrasion', val: tyre}
                ]},
                {name: 'A1.4 Wastewater', val: ww, children: []},
                {name: 'A1.5 Solid Waste Mgmt', val: solid, children: [
                    {name: 'Collection', val: swC},
                    {name: 'Transport', val: swT},
                    {name: 'Disposal', val: swD}
                ]},
                {name: 'A1.6 Uncollected Waste', val: uncoll, children: [
                    {name: 'Littering', val: lit},
                    {name: 'Open Burning', val: brn}
                ]},
                {name: 'A1.7 Recovery', val: rec, children: []}
            ].filter(d => d.val > 0);
            
            drawCharts(data);
            drawTable(data, total, pop);
            
            document.getElementById('pieDiv').style.display = 'block';
            document.getElementById('barDiv').style.display = 'block';
            document.getElementById('table').style.display = 'table';
        }

        function drawCharts(data) {
            const pieCtx = document.getElementById('pie').getContext('2d');
            if (pieChart) pieChart.destroy();
            
            pieChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => d.val),
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#E74C3C'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {display: true, text: 'Plastic Leakage by Main Category', font: {size: 16, weight: 'bold'}},
                        legend: {position: 'bottom', labels: {padding: 10, font: {size: 11}}}
                    }
                }
            });

            const barCtx = document.getElementById('bar').getContext('2d');
            if (barChart) barChart.destroy();
            
            const subs = [];
            const vals = [];
            data.forEach(d => {
                if (d.children && d.children.length > 0) {
                    d.children.forEach(c => {
                        if (c.children && c.children.length > 0) {
                            c.children.forEach(sc => {
                                if (sc.val > 0) {
                                    subs.push(sc.name);
                                    vals.push(sc.val);
                                }
                            });
                        } else {
                            subs.push(c.name);
                            vals.push(c.val);
                        }
                    });
                } else {
                    subs.push(d.name);
                    vals.push(d.val);
                }
            });
            
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: subs,
                    datasets: [{
                        label: 'Plastic Leakage (kg/year)',
                        data: vals,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        title: {display: true, text: 'Plastic Leakage by Subcategory', font: {size: 16, weight: 'bold'}},
                        legend: {display: false}
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {callback: function(val) { return val.toLocaleString(); }}
                        }
                    }
                }
            });
        }

        function drawTable(data, total, pop) {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';
            
            data.forEach(main => {
                const pct = ((main.val / total) * 100).toFixed(1);
                const pc = pop > 0 ? (main.val / pop).toFixed(4) : 'N/A';
                
                const row = tbody.insertRow();
                row.className = 'level-1';
                row.innerHTML = `<td><strong>${main.name}</strong></td><td><strong>${main.val.toLocaleString('en-US', {maximumFractionDigits: 0})}</strong></td><td><strong>${pct}%</strong></td><td><strong>${pc}</strong></td>`;
                
                if (main.children && main.children.length > 0) {
                    main.children.forEach(sub => {
                        if (sub.val > 0) {
                            const spct = ((sub.val / total) * 100).toFixed(1);
                            const spc = pop > 0 ? (sub.val / pop).toFixed(4) : 'N/A';
                            const srow = tbody.insertRow();
                            srow.className = 'level-2';
                            srow.innerHTML = `<td>${sub.name}</td><td>${sub.val.toLocaleString('en-US', {maximumFractionDigits: 0})}</td><td>${spct}%</td><td>${spc}</td>`;
                            
                            if (sub.children && sub.children.length > 0) {
                                sub.children.forEach(subsub => {
                                    if (subsub.val > 0) {
                                        const sspct = ((subsub.val / total) * 100).toFixed(1);
                                        const sspc = pop > 0 ? (subsub.val / pop).toFixed(4) : 'N/A';
                                        const ssrow = tbody.insertRow();
                                        ssrow.className = 'level-3';
                                        ssrow.innerHTML = `<td>${subsub.name}</td><td>${subsub.val.toLocaleString('en-US', {maximumFractionDigits: 0})}</td><td>${sspct}%</td><td>${sspc}</td>`;
                                    }
                                });
                            }
                        }
                    });
                }
            });
            
            const trow = tbody.insertRow();
            trow.className = 'total-row';
            const tpc = pop > 0 ? (total / pop).toFixed(4) : 'N/A';
            trow.innerHTML = `<td>TOTAL LEAKAGE</td><td>${total.toLocaleString('en-US', {maximumFractionDigits: 0})}</td><td>100.0%</td><td>${tpc}</td>`;
        }
    </script>
</body>
</html>